import React, { useRef, useEffect } from 'react';
import { Helmet } from 'react-helmet';
import L from 'leaflet';
import { Marker, useMap, Polyline } from 'react-leaflet';

import { promiseToFlyTo, getCurrentLocation } from 'lib/map';

import Layout from 'components/Layout';
import Container from 'components/Container';
import Map from 'components/Map';
import Snippet from 'components/Snippet';

import gatsby_astronaut from 'assets/images/gatsby-astronaut.jpg';

const LOCATION = {
  lat: 40.1358,
  lng: -4.0210,
};

const CENTER = [LOCATION.lat, LOCATION.lng];
const DEFAULT_ZOOM = 7;
const ZOOM = 7;

const timeToZoom = 2000;
const timeToOpenPopupAfterZoom = 4000;
const timeToUpdatePopupAfterZoom = timeToOpenPopupAfterZoom + 3000;

const popupContentHello = `<p>Hello ðŸ‘‹</p>`;
const popupContentGatsby = `
  <div class="popup-gatsby">
    <div class="popup-gatsby-image">
      <img class="gatsby-astronaut" src=${gatsby_astronaut} />
    </div>
    <div class="popup-gatsby-content">
      <h1>Gatsby Leaflet Starter</h1>
      <p>Welcome to your new Gatsby site. Now go build something great!</p>
    </div>
  </div>
`;

/**
 * MapEffect
 * @description This is an example of creating an effect used to zoom in and set a popup on load
 */

const MapEffect = ({ markerRef }) => {
  const map = useMap();

  useEffect(() => {
    if ( !markerRef.current || !map ) return;

    ( async function run() {
      const popup = L.popup({
        maxWidth: 800,
      });

      var geojsonFeature = {
          "type": "Feature",
          "properties": {
            "_umap_options": {
              "weight": "5",
              "opacity": "0.6"
            },
            "name": "CaÃ±ada Real Segoviana"
          },
          "geometry": {
            "type": "MultiLineString",
            "coordinates": [
              [
                [
                  -4.010738,
                  40.63477
                ],
                [
                  -4.011564,
                  40.634045
                ],
                [
                  -4.012519,
                  40.634639
                ],
                [
                  -4.014129,
                  40.634167
                ],
                [
                  -4.015084,
                  40.633321
                ],
                [
                  -4.017058,
                  40.632458
                ],
                [
                  -4.018646,
                  40.631554
                ],
                [
                  -4.020213,
                  40.631318
                ],
                [
                  -4.023848,
                  40.630681
                ],
                [
                  -4.027088,
                  40.630461
                ],
                [
                  -4.029598,
                  40.630404
                ]
              ],
              [
                [
                  -4.032126,
                  40.640788
                ],
                [
                  -4.032338,
                  40.640344
                ],
                [
                  -4.03206,
                  40.63999
                ],
                [
                  -4.031052,
                  40.639005
                ],
                [
                  -4.030923,
                  40.637637
                ],
                [
                  -4.030536,
                  40.637164
                ],
                [
                  -4.029883,
                  40.634631
                ],
                [
                  -4.029368,
                  40.632042
                ],
                [
                  -4.029154,
                  40.630797
                ],
                [
                  -4.029598,
                  40.630404
                ],
                [
                  -4.029856,
                  40.628637
                ],
                [
                  -4.029598,
                  40.627953
                ],
                [
                  -4.029365,
                  40.627397
                ],
                [
                  -4.029858,
                  40.626819
                ],
                [
                  -4.030663,
                  40.624572
                ],
                [
                  -4.030598,
                  40.623701
                ],
                [
                  -4.03107,
                  40.623025
                ],
                [
                  -4.031101,
                  40.622097
                ],
                [
                  -4.032871,
                  40.620273
                ],
                [
                  -4.033687,
                  40.619288
                ],
                [
                  -4.034942,
                  40.618164
                ],
                [
                  -4.03521,
                  40.616885
                ],
                [
                  -4.035435,
                  40.616315
                ],
                [
                  -4.035495,
                  40.615552
                ],
                [
                  -4.035598,
                  40.61493
                ],
                [
                  -4.036306,
                  40.614319
                ],
                [
                  -4.036541,
                  40.611569
                ],
                [
                  -4.037731,
                  40.609826
                ],
                [
                  -4.037345,
                  40.609191
                ],
                [
                  -4.037946,
                  40.60801
                ],
                [
                  -4.038191,
                  40.606839
                ],
                [
                  -4.037969,
                  40.60641
                ],
                [
                  -4.039257,
                  40.601718
                ],
                [
                  -4.039128,
                  40.595478
                ],
                [
                  -4.039366,
                  40.593319
                ],
                [
                  -4.041082,
                  40.590712
                ],
                [
                  -4.042885,
                  40.58918
                ],
                [
                  -4.044023,
                  40.58784
                ],
                [
                  -4.0446,
                  40.585539
                ],
                [
                  -4.045029,
                  40.583135
                ],
                [
                  -4.056779,
                  40.52192
                ],
                [
                  -4.05642,
                  40.519845
                ],
                [
                  -4.055691,
                  40.518173
                ],
                [
                  -4.055895,
                  40.516158
                ],
                [
                  -4.05477,
                  40.512044
                ],
                [
                  -4.056057,
                  40.507802
                ],
                [
                  -4.056229,
                  40.506954
                ],
                [
                  -4.054684,
                  40.505191
                ],
                [
                  -4.054469,
                  40.502875
                ],
                [
                  -4.052667,
                  40.499775
                ],
                [
                  -4.052104,
                  40.499124
                ],
                [
                  -4.051042,
                  40.498421
                ],
                [
                  -4.051047,
                  40.497875
                ],
                [
                  -4.050318,
                  40.494377
                ],
                [
                  -4.049557,
                  40.491703
                ],
                [
                  -4.049443,
                  40.491476
                ],
                [
                  -4.04989,
                  40.4913
                ],
                [
                  -4.050418,
                  40.490728
                ],
                [
                  -4.050944,
                  40.488728
                ],
                [
                  -4.052204,
                  40.48691
                ],
                [
                  -4.052612,
                  40.486013
                ],
                [
                  -4.052622,
                  40.485303
                ],
                [
                  -4.052106,
                  40.483839
                ],
                [
                  -4.052189,
                  40.48306
                ],
                [
                  -4.052354,
                  40.482311
                ],
                [
                  -4.05272,
                  40.480855
                ],
                [
                  -4.051883,
                  40.479063
                ],
                [
                  -4.051066,
                  40.47701
                ],
                [
                  -4.051269,
                  40.476414
                ],
                [
                  -4.051495,
                  40.47599
                ],
                [
                  -4.051044,
                  40.473745
                ],
                [
                  -4.0504,
                  40.473411
                ],
                [
                  -4.050354,
                  40.472849
                ],
                [
                  -4.049925,
                  40.472204
                ],
                [
                  -4.049195,
                  40.471926
                ],
                [
                  -4.049334,
                  40.470922
                ],
                [
                  -4.04912,
                  40.470286
                ],
                [
                  -4.051158,
                  40.469176
                ],
                [
                  -4.05153,
                  40.46845
                ],
                [
                  -4.052334,
                  40.468074
                ],
                [
                  -4.053268,
                  40.466972
                ],
                [
                  -4.052957,
                  40.465585
                ],
                [
                  -4.05275,
                  40.464944
                ],
                [
                  -4.052965,
                  40.464568
                ],
                [
                  -4.053406,
                  40.464496
                ],
                [
                  -4.053212,
                  40.464121
                ],
                [
                  -4.052936,
                  40.46365
                ],
                [
                  -4.052324,
                  40.463054
                ],
                [
                  -4.052425,
                  40.460709
                ],
                [
                  -4.053391,
                  40.460366
                ],
                [
                  -4.053727,
                  40.460402
                ],
                [
                  -4.053831,
                  40.460271
                ],
                [
                  -4.053552,
                  40.460116
                ],
                [
                  -4.052951,
                  40.459651
                ],
                [
                  -4.052629,
                  40.45863
                ],
                [
                  -4.051524,
                  40.456647
                ],
                [
                  -4.051535,
                  40.456165
                ],
                [
                  -4.051878,
                  40.455847
                ],
                [
                  -4.051105,
                  40.45543
                ],
                [
                  -4.051109,
                  40.454941
                ],
                [
                  -4.051184,
                  40.453643
                ],
                [
                  -4.051034,
                  40.453316
                ],
                [
                  -4.051227,
                  40.45294
                ],
                [
                  -4.050809,
                  40.451634
                ],
                [
                  -4.050991,
                  40.451438
                ],
                [
                  -4.051302,
                  40.450344
                ],
                [
                  -4.051557,
                  40.449935
                ],
                [
                  -4.051516,
                  40.449398
                ],
                [
                  -4.051409,
                  40.449023
                ],
                [
                  -4.051355,
                  40.447414
                ],
                [
                  -4.051419,
                  40.447333
                ],
                [
                  -4.05055,
                  40.445757
                ],
                [
                  -4.050616,
                  40.443474
                ],
                [
                  -4.050713,
                  40.443041
                ],
                [
                  -4.050633,
                  40.442587
                ],
                [
                  -4.050676,
                  40.44226
                ],
                [
                  -4.050643,
                  40.440798
                ],
                [
                  -4.051019,
                  40.440039
                ],
                [
                  -4.050879,
                  40.439394
                ],
                [
                  -4.051201,
                  40.438741
                ],
                [
                  -4.051405,
                  40.438545
                ],
                [
                  -4.051545,
                  40.438267
                ],
                [
                  -4.052486,
                  40.436871
                ],
                [
                  -4.052765,
                  40.435932
                ],
                [
                  -4.052722,
                  40.435246
                ],
                [
                  -4.053291,
                  40.434682
                ],
                [
                  -4.053452,
                  40.434339
                ],
                [
                  -4.053935,
                  40.433711
                ],
                [
                  -4.054932,
                  40.433155
                ],
                [
                  -4.055413,
                  40.432702
                ],
                [
                  -4.056068,
                  40.431175
                ],
                [
                  -4.05801,
                  40.429352
                ],
                [
                  -4.060102,
                  40.428723
                ],
                [
                  -4.059856,
                  40.428347
                ],
                [
                  -4.058804,
                  40.428004
                ],
                [
                  -4.058525,
                  40.427441
                ],
                [
                  -4.058772,
                  40.427318
                ],
                [
                  -4.058772,
                  40.425954
                ],
                [
                  -4.058965,
                  40.425505
                ],
                [
                  -4.058622,
                  40.425105
                ],
                [
                  -4.059062,
                  40.424778
                ],
                [
                  -4.059319,
                  40.424811
                ],
                [
                  -4.060167,
                  40.424231
                ],
                [
                  -4.060551,
                  40.423693
                ],
                [
                  -4.060757,
                  40.423096
                ],
                [
                  -4.060767,
                  40.422611
                ],
                [
                  -4.061024,
                  40.42239
                ],
                [
                  -4.061818,
                  40.422439
                ],
                [
                  -4.062515,
                  40.422023
                ],
                [
                  -4.062891,
                  40.421655
                ],
                [
                  -4.064393,
                  40.421173
                ],
                [
                  -4.065101,
                  40.420569
                ],
                [
                  -4.06612,
                  40.419237
                ],
                [
                  -4.067601,
                  40.418567
                ],
                [
                  -4.070102,
                  40.416451
                ],
                [
                  -4.070671,
                  40.415699
                ],
                [
                  -4.072119,
                  40.414801
                ],
                [
                  -4.073955,
                  40.411961
                ],
                [
                  -4.07404,
                  40.411496
                ],
                [
                  -4.076326,
                  40.408057
                ],
                [
                  -4.076855,
                  40.407155
                ],
                [
                  -4.077788,
                  40.406697
                ],
                [
                  -4.079591,
                  40.404883
                ],
                [
                  -4.08031,
                  40.403927
                ],
                [
                  -4.080754,
                  40.403702
                ],
                [
                  -4.081415,
                  40.403658
                ],
                [
                  -4.082291,
                  40.403189
                ],
                [
                  -4.082929,
                  40.402605
                ],
                [
                  -4.083424,
                  40.401545
                ],
                [
                  -4.083317,
                  40.401267
                ],
                [
                  -4.083387,
                  40.400757
                ],
                [
                  -4.083473,
                  40.400732
                ],
                [
                  -4.083494,
                  40.400503
                ],
                [
                  -4.083677,
                  40.40025
                ],
                [
                  -4.083419,
                  40.399
                ],
                [
                  -4.083173,
                  40.398665
                ],
                [
                  -4.083301,
                  40.397905
                ],
                [
                  -4.083509,
                  40.396892
                ],
                [
                  -4.083326,
                  40.395863
                ],
                [
                  -4.083981,
                  40.394269
                ],
                [
                  -4.084238,
                  40.392251
                ],
                [
                  -4.084078,
                  40.389772
                ],
                [
                  -4.083305,
                  40.387901
                ],
                [
                  -4.078762,
                  40.383627
                ],
                [
                  -4.080407,
                  40.383023
                ],
                [
                  -4.081758,
                  40.382827
                ],
                [
                  -4.085599,
                  40.381405
                ],
                [
                  -4.089912,
                  40.380261
                ],
                [
                  -4.093582,
                  40.380244
                ],
                [
                  -4.095727,
                  40.380212
                ],
                [
                  -4.097251,
                  40.378806
                ],
                [
                  -4.097551,
                  40.377302
                ],
                [
                  -4.098989,
                  40.376567
                ],
                [
                  -4.100233,
                  40.376468
                ],
                [
                  -4.104053,
                  40.375635
                ],
                [
                  -4.106478,
                  40.374932
                ],
                [
                  -4.108581,
                  40.374229
                ],
                [
                  -4.107845,
                  40.37238
                ],
                [
                  -4.10733,
                  40.371824
                ],
                [
                  -4.107609,
                  40.371514
                ],
                [
                  -4.107867,
                  40.371236
                ],
                [
                  -4.107352,
                  40.370042
                ],
                [
                  -4.107168,
                  40.36928
                ],
                [
                  -4.106848,
                  40.368602
                ],
                [
                  -4.105346,
                  40.366951
                ],
                [
                  -4.104939,
                  40.365839
                ],
                [
                  -4.104617,
                  40.362585
                ],
                [
                  -4.103544,
                  40.361555
                ],
                [
                  -4.103651,
                  40.360934
                ],
                [
                  -4.103372,
                  40.360394
                ],
                [
                  -4.103093,
                  40.359626
                ],
                [
                  -4.102063,
                  40.358367
                ],
                [
                  -4.102256,
                  40.357942
                ],
                [
                  -4.101655,
                  40.356634
                ],
                [
                  -4.101231,
                  40.354665
                ],
                [
                  -4.101316,
                  40.353014
                ],
                [
                  -4.101381,
                  40.352049
                ],
                [
                  -4.099402,
                  40.349749
                ],
                [
                  -4.098394,
                  40.349144
                ],
                [
                  -4.097493,
                  40.34728
                ],
                [
                  -4.0979,
                  40.345219
                ],
                [
                  -4.096313,
                  40.343241
                ],
                [
                  -4.095272,
                  40.341113
                ],
                [
                  -4.095723,
                  40.340066
                ],
                [
                  -4.096238,
                  40.337874
                ],
                [
                  -4.097214,
                  40.337009
                ],
                [
                  -4.097664,
                  40.335014
                ],
                [
                  -4.098394,
                  40.333983
                ],
                [
                  -4.098115,
                  40.332969
                ],
                [
                  -4.097986,
                  40.330368
                ],
                [
                  -4.099972,
                  40.32731
                ],
                [
                  -4.099865,
                  40.326133
                ],
                [
                  -4.101646,
                  40.324022
                ],
                [
                  -4.102504,
                  40.321748
                ],
                [
                  -4.102783,
                  40.321192
                ],
                [
                  -4.102783,
                  40.320341
                ],
                [
                  -4.103255,
                  40.319507
                ],
                [
                  -4.102739,
                  40.315279
                ],
                [
                  -4.10332,
                  40.312723
                ],
                [
                  -4.103404,
                  40.30988
                ],
                [
                  -4.103506,
                  40.307918
                ],
                [
                  -4.104059,
                  40.305827
                ],
                [
                  -4.105161,
                  40.30503
                ],
                [
                  -4.104145,
                  40.303569
                ],
                [
                  -4.104831,
                  40.302473
                ],
                [
                  -4.104853,
                  40.300754
                ],
                [
                  -4.105754,
                  40.298676
                ],
                [
                  -4.106766,
                  40.297296
                ],
                [
                  -4.108414,
                  40.296734
                ],
                [
                  -4.110946,
                  40.296619
                ],
                [
                  -4.111869,
                  40.296914
                ],
                [
                  -4.112405,
                  40.295654
                ],
                [
                  -4.113907,
                  40.294803
                ],
                [
                  -4.113971,
                  40.293035
                ],
                [
                  -4.113306,
                  40.291038
                ],
                [
                  -4.112023,
                  40.289283
                ],
                [
                  -4.11123,
                  40.289052
                ],
                [
                  -4.110974,
                  40.28844
                ],
                [
                  -4.109251,
                  40.286572
                ],
                [
                  -4.109433,
                  40.285696
                ],
                [
                  -4.108617,
                  40.284523
                ],
                [
                  -4.108747,
                  40.284075
                ],
                [
                  -4.108234,
                  40.283434
                ],
                [
                  -4.107659,
                  40.282222
                ],
                [
                  -4.106851,
                  40.281267
                ],
                [
                  -4.10636,
                  40.280474
                ],
                [
                  -4.106218,
                  40.279339
                ],
                [
                  -4.10575,
                  40.278288
                ],
                [
                  -4.104845,
                  40.276945
                ],
                [
                  -4.100553,
                  40.27336
                ],
                [
                  -4.099788,
                  40.272766
                ],
                [
                  -4.098973,
                  40.271227
                ],
                [
                  -4.098843,
                  40.269849
                ],
                [
                  -4.098946,
                  40.268153
                ],
                [
                  -4.097187,
                  40.264632
                ],
                [
                  -4.095219,
                  40.263903
                ],
                [
                  -4.093689,
                  40.262746
                ],
                [
                  -4.093196,
                  40.261141
                ],
                [
                  -4.092724,
                  40.260535
                ],
                [
                  -4.09229,
                  40.25944
                ],
                [
                  -4.091093,
                  40.258406
                ],
                [
                  -4.089226,
                  40.25541
                ],
                [
                  -4.087681,
                  40.253281
                ],
                [
                  -4.088688,
                  40.253092
                ],
                [
                  -4.087229,
                  40.250111
                ],
                [
                  -4.087786,
                  40.24831
                ],
                [
                  -4.088629,
                  40.246904
                ],
                [
                  -4.088902,
                  40.246033
                ],
                [
                  -4.090383,
                  40.244821
                ],
                [
                  -4.091408,
                  40.244016
                ],
                [
                  -4.092717,
                  40.243477
                ],
                [
                  -4.0933,
                  40.240946
                ],
                [
                  -4.0939,
                  40.240275
                ],
                [
                  -4.093707,
                  40.239521
                ],
                [
                  -4.093988,
                  40.239303
                ],
                [
                  -4.094155,
                  40.23839
                ],
                [
                  -4.093819,
                  40.23666
                ],
                [
                  -4.094527,
                  40.23548
                ],
                [
                  -4.094699,
                  40.233842
                ],
                [
                  -4.095686,
                  40.232122
                ],
                [
                  -4.094827,
                  40.230727
                ],
                [
                  -4.095514,
                  40.229204
                ],
                [
                  -4.095814,
                  40.227582
                ],
                [
                  -4.095599,
                  40.22578
                ],
                [
                  -4.095363,
                  40.224617
                ],
                [
                  -4.095299,
                  40.222913
                ],
                [
                  -4.096072,
                  40.219193
                ],
                [
                  -4.096286,
                  40.21803
                ],
                [
                  -4.096355,
                  40.216016
                ],
                [
                  -4.095604,
                  40.213935
                ],
                [
                  -4.095304,
                  40.212935
                ],
                [
                  -4.095583,
                  40.212214
                ],
                [
                  -4.095089,
                  40.211166
                ],
                [
                  -4.09245,
                  40.207249
                ],
                [
                  -4.092234,
                  40.20681
                ],
                [
                  -4.093415,
                  40.204794
                ],
                [
                  -4.092964,
                  40.203155
                ],
                [
                  -4.092706,
                  40.202582
                ],
                [
                  -4.093844,
                  40.201582
                ],
                [
                  -4.097427,
                  40.198566
                ],
                [
                  -4.09835,
                  40.197517
                ],
                [
                  -4.100812,
                  40.194236
                ],
                [
                  -4.10243,
                  40.193103
                ],
                [
                  -4.102623,
                  40.192382
                ],
                [
                  -4.103117,
                  40.191497
                ],
                [
                  -4.10419,
                  40.190661
                ],
                [
                  -4.104962,
                  40.18953
                ],
                [
                  -4.105799,
                  40.188612
                ],
                [
                  -4.1064,
                  40.188202
                ],
                [
                  -4.106807,
                  40.187169
                ],
                [
                  -4.107993,
                  40.185709
                ],
                [
                  -4.108165,
                  40.18461
                ],
                [
                  -4.108229,
                  40.183545
                ],
                [
                  -4.10971,
                  40.182479
                ],
                [
                  -4.110332,
                  40.181578
                ],
                [
                  -4.110847,
                  40.180676
                ],
                [
                  -4.112757,
                  40.178364
                ],
                [
                  -4.113572,
                  40.176807
                ],
                [
                  -4.113594,
                  40.176381
                ],
                [
                  -4.11398,
                  40.174757
                ],
                [
                  -4.113558,
                  40.174043
                ],
                [
                  -4.115403,
                  40.172715
                ],
                [
                  -4.115145,
                  40.172124
                ],
                [
                  -4.115811,
                  40.170534
                ],
                [
                  -4.115896,
                  40.169222
                ],
                [
                  -4.116626,
                  40.168271
                ],
                [
                  -4.118343,
                  40.166025
                ],
                [
                  -4.121399,
                  40.161835
                ],
                [
                  -4.123373,
                  40.159998
                ],
                [
                  -4.123375,
                  40.159695
                ],
                [
                  -4.12403,
                  40.159114
                ],
                [
                  -4.125468,
                  40.157901
                ],
                [
                  -4.126648,
                  40.157228
                ],
                [
                  -4.126669,
                  40.156819
                ],
                [
                  -4.132334,
                  40.153571
                ],
                [
                  -4.133836,
                  40.152948
                ],
                [
                  -4.142653,
                  40.148476
                ],
                [
                  -4.146644,
                  40.143063
                ],
                [
                  -4.148661,
                  40.140701
                ],
                [
                  -4.15188,
                  40.137453
                ],
                [
                  -4.154626,
                  40.136272
                ],
                [
                  -4.155828,
                  40.134861
                ],
                [
                  -4.1563,
                  40.131547
                ],
                [
                  -4.156195,
                  40.129811
                ],
                [
                  -4.156881,
                  40.128859
                ],
                [
                  -4.157869,
                  40.127678
                ],
                [
                  -4.158598,
                  40.1263
                ],
                [
                  -4.160315,
                  40.119441
                ],
                [
                  -4.159886,
                  40.11908
                ],
                [
                  -4.161345,
                  40.115798
                ],
                [
                  -4.16246,
                  40.115306
                ],
                [
                  -4.171001,
                  40.111761
                ],
                [
                  -4.174434,
                  40.108972
                ],
                [
                  -4.176904,
                  40.104794
                ],
                [
                  -4.18171,
                  40.097933
                ],
                [
                  -4.18244,
                  40.09639
                ],
                [
                  -4.183127,
                  40.093534
                ],
                [
                  -4.189821,
                  40.085622
                ],
                [
                  -4.192954,
                  40.083192
                ],
                [
                  -4.201231,
                  40.074299
                ],
                [
                  -4.202647,
                  40.071737
                ],
                [
                  -4.206681,
                  40.068223
                ],
                [
                  -4.211015,
                  40.064446
                ],
                [
                  -4.212291,
                  40.064147
                ],
                [
                  -4.213407,
                  40.063424
                ],
                [
                  -4.214523,
                  40.063063
                ],
                [
                  -4.215552,
                  40.062045
                ],
                [
                  -4.220531,
                  40.060008
                ],
                [
                  -4.223191,
                  40.059483
                ],
                [
                  -4.225595,
                  40.05876
                ],
                [
                  -4.2298,
                  40.058202
                ],
                [
                  -4.232804,
                  40.057906
                ],
                [
                  -4.235993,
                  40.057734
                ],
                [
                  -4.238397,
                  40.057241
                ],
                [
                  -4.240946,
                  40.05622
                ],
                [
                  -4.24498,
                  40.054085
                ],
                [
                  -4.246825,
                  40.052311
                ],
                [
                  -4.260816,
                  40.038151
                ],
                [
                  -4.271311,
                  40.027552
                ],
                [
                  -4.272856,
                  40.024989
                ],
                [
                  -4.28307,
                  40.007372
                ],
                [
                  -4.285363,
                  40.003882
                ],
                [
                  -4.28978,
                  39.999534
                ],
                [
                  -4.29059,
                  39.99869
                ],
                [
                  -4.291363,
                  39.995764
                ],
                [
                  -4.292994,
                  39.99606
                ],
                [
                  -4.297199,
                  39.993528
                ],
                [
                  -4.301319,
                  39.990208
                ],
                [
                  -4.30524,
                  39.985227
                ],
                [
                  -4.306827,
                  39.98184
                ],
                [
                  -4.308158,
                  39.979077
                ],
                [
                  -4.313908,
                  39.973092
                ],
                [
                  -4.319381,
                  39.968708
                ],
                [
                  -4.320411,
                  39.968247
                ],
                [
                  -4.320711,
                  39.967261
                ],
                [
                  -4.322513,
                  39.966603
                ],
                [
                  -4.327835,
                  39.959432
                ],
                [
                  -4.328736,
                  39.956373
                ],
                [
                  -4.329847,
                  39.954218
                ],
                [
                  -4.330576,
                  39.953198
                ],
                [
                  -4.333495,
                  39.943756
                ],
                [
                  -4.338816,
                  39.936484
                ],
                [
                  -4.339245,
                  39.934082
                ],
                [
                  -4.338704,
                  39.92709
                ],
                [
                  -4.339862,
                  39.920804
                ],
                [
                  -4.341665,
                  39.91455
                ],
                [
                  -4.342094,
                  39.914188
                ],
                [
                  -4.342952,
                  39.911357
                ],
                [
                  -4.342522,
                  39.90993
                ],
                [
                  -4.339128,
                  39.908123
                ],
                [
                  -4.335292,
                  39.904237
                ],
                [
                  -4.331617,
                  39.901559
                ],
                [
                  -4.33136,
                  39.897246
                ],
                [
                  -4.332519,
                  39.896949
                ],
                [
                  -4.333634,
                  39.893571
                ],
                [
                  -4.338913,
                  39.890674
                ],
                [
                  -4.34093,
                  39.889884
                ],
                [
                  -4.341058,
                  39.885235
                ],
                [
                  -4.338311,
                  39.879011
                ],
                [
                  -4.337667,
                  39.873511
                ],
                [
                  -4.336122,
                  39.868076
                ],
                [
                  -4.335823,
                  39.865611
                ],
                [
                  -4.334467,
                  39.862913
                ],
                [
                  -4.334383,
                  39.860522
                ],
                [
                  -4.335283,
                  39.858531
                ],
                [
                  -4.336055,
                  39.856785
                ],
                [
                  -4.340175,
                  39.854446
                ],
                [
                  -4.345017,
                  39.849907
                ],
                [
                  -4.345575,
                  39.848786
                ],
                [
                  -4.348279,
                  39.847699
                ],
                [
                  -4.351798,
                  39.845129
                ],
                [
                  -4.354932,
                  39.842839
                ],
                [
                  -4.361412,
                  39.842938
                ],
                [
                  -4.365317,
                  39.840269
                ],
                [
                  -4.367635,
                  39.839314
                ],
                [
                  -4.368622,
                  39.838721
                ],
                [
                  -4.374072,
                  39.834865
                ],
                [
                  -4.37463,
                  39.829065
                ],
                [
                  -4.373425,
                  39.818545
                ],
                [
                  -4.372652,
                  39.817655
                ],
                [
                  -4.37291,
                  39.816237
                ],
                [
                  -4.372523,
                  39.815149
                ],
                [
                  -4.372867,
                  39.811293
                ],
                [
                  -4.372867,
                  39.809117
                ],
                [
                  -4.372781,
                  39.805919
                ],
                [
                  -4.371622,
                  39.802952
                ],
                [
                  -4.370721,
                  39.80249
                ],
                [
                  -4.368833,
                  39.800116
                ],
                [
                  -4.368919,
                  39.798666
                ],
                [
                  -4.370114,
                  39.795243
                ],
                [
                  -4.370072,
                  39.793331
                ],
                [
                  -4.371488,
                  39.791847
                ],
                [
                  -4.372217,
                  39.79099
                ],
                [
                  -4.371359,
                  39.787593
                ],
                [
                  -4.369599,
                  39.783669
                ],
                [
                  -4.368999,
                  39.782119
                ],
                [
                  -4.369986,
                  39.780371
                ],
                [
                  -4.370672,
                  39.779843
                ],
                [
                  -4.370887,
                  39.778821
                ],
                [
                  -4.373152,
                  39.773779
                ],
                [
                  -4.37224,
                  39.772963
                ],
                [
                  -4.371737,
                  39.770303
                ],
                [
                  -4.369976,
                  39.768139
                ],
                [
                  -4.370663,
                  39.766094
                ],
                [
                  -4.370319,
                  39.765071
                ],
                [
                  -4.371431,
                  39.763327
                ],
                [
                  -4.370144,
                  39.761612
                ],
                [
                  -4.37336,
                  39.76156
                ],
                [
                  -4.376852,
                  39.762154
                ],
                [
                  -4.3802,
                  39.76321
                ],
                [
                  -4.381831,
                  39.764134
                ],
                [
                  -4.381916,
                  39.762484
                ],
                [
                  -4.382636,
                  39.760265
                ],
                [
                  -4.382722,
                  39.758417
                ],
                [
                  -4.379718,
                  39.755976
                ],
                [
                  -4.377596,
                  39.746399
                ],
                [
                  -4.372197,
                  39.745759
                ],
                [
                  -4.365159,
                  39.746551
                ],
                [
                  -4.359582,
                  39.745177
                ],
                [
                  -4.355237,
                  39.745202
                ],
                [
                  -4.352217,
                  39.74191
                ],
                [
                  -4.349556,
                  39.741184
                ],
                [
                  -4.347496,
                  39.737884
                ],
                [
                  -4.349556,
                  39.731878
                ],
                [
                  -4.352474,
                  39.726201
                ],
                [
                  -4.354293,
                  39.72517
                ],
                [
                  -4.35322,
                  39.722562
                ],
                [
                  -4.352662,
                  39.718964
                ],
                [
                  -4.354019,
                  39.716728
                ],
                [
                  -4.354491,
                  39.713657
                ],
                [
                  -4.353504,
                  39.71237
                ],
                [
                  -4.354019,
                  39.710455
                ],
                [
                  -4.354519,
                  39.709049
                ],
                [
                  -4.353504,
                  39.707088
                ],
                [
                  -4.350124,
                  39.704189
                ],
                [
                  -4.350124,
                  39.702934
                ],
                [
                  -4.34986,
                  39.702712
                ],
                [
                  -4.350418,
                  39.701788
                ],
                [
                  -4.351118,
                  39.699451
                ],
                [
                  -4.35159,
                  39.699088
                ],
                [
                  -4.350217,
                  39.694036
                ],
                [
                  -4.348692,
                  39.690921
                ],
                [
                  -4.348048,
                  39.690426
                ],
                [
                  -4.346718,
                  39.688147
                ],
                [
                  -4.346761,
                  39.68719
                ],
                [
                  -4.348311,
                  39.686285
                ],
                [
                  -4.348483,
                  39.684501
                ],
                [
                  -4.349427,
                  39.683477
                ],
                [
                  -4.349117,
                  39.682862
                ],
                [
                  -4.349632,
                  39.682334
                ],
                [
                  -4.35019,
                  39.68197
                ],
                [
                  -4.350876,
                  39.680088
                ],
                [
                  -4.351005,
                  39.675794
                ],
                [
                  -4.351194,
                  39.66735
                ],
                [
                  -4.351538,
                  39.663122
                ],
                [
                  -4.350722,
                  39.660149
                ],
                [
                  -4.351495,
                  39.655622
                ],
                [
                  -4.352139,
                  39.654234
                ],
                [
                  -4.351967,
                  39.65288
                ],
                [
                  -4.352267,
                  39.652417
                ],
                [
                  -4.351538,
                  39.651096
                ],
                [
                  -4.352396,
                  39.650666
                ],
                [
                  -4.352396,
                  39.649344
                ],
                [
                  -4.35334,
                  39.647593
                ],
                [
                  -4.352267,
                  39.64604
                ],
                [
                  -4.352825,
                  39.645643
                ],
                [
                  -4.351924,
                  39.644321
                ],
                [
                  -4.352482,
                  39.641975
                ],
                [
                  -4.353169,
                  39.640191
                ],
                [
                  -4.354877,
                  39.635984
                ],
                [
                  -4.355564,
                  39.635488
                ],
                [
                  -4.355264,
                  39.633736
                ],
                [
                  -4.35668,
                  39.631291
                ],
                [
                  -4.357409,
                  39.629704
                ],
                [
                  -4.358353,
                  39.628481
                ],
                [
                  -4.359164,
                  39.625816
                ],
                [
                  -4.359097,
                  39.624776
                ],
                [
                  -4.35955,
                  39.623998
                ],
                [
                  -4.359124,
                  39.62267
                ],
                [
                  -4.361052,
                  39.622114
                ],
                [
                  -4.361486,
                  39.620802
                ],
                [
                  -4.360936,
                  39.619421
                ],
                [
                  -4.36181,
                  39.618851
                ],
                [
                  -4.359636,
                  39.61742
                ],
                [
                  -4.347504,
                  39.612652
                ]
              ]
            ]
          }
        
    };

      L.geoJSON(geojsonFeature).addTo(map);


      const location = await getCurrentLocation().catch(() => LOCATION );

      const { current: marker } = markerRef || {};

      marker.setLatLng( location );
      popup.setLatLng( location );
      popup.setContent( popupContentHello );

      setTimeout( async () => {
        await promiseToFlyTo( map, {
          zoom: ZOOM,
          center: location,
        });

        marker.bindPopup( popup );

        setTimeout(() => marker.openPopup(), timeToOpenPopupAfterZoom );
        setTimeout(() => marker.setPopupContent( popupContentGatsby ), timeToUpdatePopupAfterZoom );
      }, timeToZoom );
    })();
  }, [map, markerRef]);

  return null;
};

const IndexPage = () => {
  const markerRef = useRef();

  const mapSettings = {
    center: CENTER,
    defaultBaseMap: 'OpenStreetMap',
    zoom: DEFAULT_ZOOM,
  };

  const polyline = [
    [51.505, -0.09],
    [51.51, -0.1],
    [51.51, -0.12],
  ]
  


  const limeOptions = { color: 'blue' }

  return (
    <Layout pageName="home">
      <Helmet>
        <title>Home Page</title>
      </Helmet>

      <Map {...mapSettings}>
        <MapEffect markerRef={markerRef} />
        <Marker ref={markerRef} position={CENTER} />
      </Map>
      
    </Layout>
  );
};

export default IndexPage;
